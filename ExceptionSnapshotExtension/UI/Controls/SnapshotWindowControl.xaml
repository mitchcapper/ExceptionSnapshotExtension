<UserControl x:Class="ExceptionSnapshotExtension.SnapshotWindowControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:vsshell="clr-namespace:Microsoft.VisualStudio.Shell;assembly=Microsoft.VisualStudio.Shell.15.0"
             xmlns:VM="clr-namespace:ExceptionSnapshotExtension.Viewmodels;assembly=ExceptionSnapshotExtension"
             xmlns:Ctr="clr-namespace:ExceptionSnapshotExtension.Controls"
             xmlns:acb="clr-namespace:AttachedCommandBehavior"
             xmlns:vs_shell="clr-namespace:Microsoft.VisualStudio.PlatformUI;assembly=Microsoft.VisualStudio.Shell.15.0"
             Background="{DynamicResource {x:Static vsshell:VsBrushes.WindowKey}}"
             Foreground="{DynamicResource {x:Static vsshell:VsBrushes.WindowTextKey}}"
             mc:Ignorable="d"
             d:DesignHeight="500" d:DesignWidth="300"
             d:DataContext="{d:DesignInstance Type=VM:ToolWindowVM, IsDesignTimeCreatable=True}"
             Name="MyToolWindow">
	<UserControl.Resources>
		<!-- TextBox Style -->
		<Style TargetType="{x:Type TextBox}">
			<Setter Property="Foreground" Value="{DynamicResource {x:Static vsshell:VsBrushes.SortTextKey}}"/>
			<Setter Property="Background" Value="{DynamicResource {x:Static vsshell:VsBrushes.SortBackgroundKey}}"/>
			<Setter Property="BorderBrush" Value="{DynamicResource {x:Static vsshell:VsBrushes.SearchBoxBorderKey}}"/>
			<Setter Property="Margin" Value="2"/>
		</Style>

		<!-- Button Style -->
		<Style TargetType="Button">
			<Setter Property="SnapsToDevicePixels" Value="true" />
			<Setter Property="OverridesDefaultStyle" Value="true" />
			<Setter Property="Foreground" Value="{DynamicResource {x:Static vsshell:VsBrushes.ToolWindowTextKey}}" />
			<Setter Property="Margin" Value="3"/>
			<Setter Property="Padding" Value="6,3"/>
			<Setter Property="MinWidth" Value="100"/>
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="Button">
						<Border x:Name="Border"
                                Background="{x:Null}"
                                BorderBrush="{DynamicResource {x:Static vsshell:VsBrushes.CommandBarBorderKey}}"
                                BorderThickness="1">
							<ContentPresenter Margin="2"
                                              HorizontalAlignment="Center"
                                              VerticalAlignment="Center"
                                              RecognizesAccessKey="True" />
						</Border>
						<ControlTemplate.Triggers>
							<Trigger Property="IsMouseOver" Value="True">
								<Setter TargetName="Border" Property="Background" Value="{DynamicResource {x:Static vsshell:VsBrushes.CommandBarMouseOverBackgroundGradientKey}}" />
								<Setter TargetName="Border" Property="BorderBrush" Value="{DynamicResource {x:Static vsshell:VsBrushes.CommandBarSelectedBorderKey}}" />
							</Trigger>
							<Trigger Property="IsPressed" Value="True">
								<Setter TargetName="Border" Property="Background" Value="{DynamicResource {x:Static vsshell:VsBrushes.CommandBarMouseDownBackgroundGradientKey}}" />
								<Setter TargetName="Border" Property="BorderBrush" Value="{DynamicResource {x:Static vsshell:VsBrushes.CommandBarMouseDownBorderKey}}" />
							</Trigger>
						</ControlTemplate.Triggers>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>

		<!-- CheckBox Style -->
		<Style TargetType="CheckBox">
			<Setter Property="Margin" Value="2"/>
			<Setter Property="VerticalAlignment" Value="Center"/>
			<Setter Property="Foreground" Value="{DynamicResource {x:Static vsshell:VsBrushes.WindowTextKey}}"/>
		</Style>

		<!-- Label Style -->
		<Style TargetType="Label">
			<Setter Property="Padding" Value="1"/>
			<Setter Property="VerticalAlignment" Value="Center"/>
		</Style>

		<!-- GroupBox Style -->
		<Style TargetType="GroupBox">
			<Setter Property="Padding" Value="5"/>
			<Setter Property="Margin" Value="3"/>
		</Style>

		<!-- StackPanel Style -->
		<Style TargetType="StackPanel">
			<Setter Property="Margin" Value="1"/>
		</Style>

	</UserControl.Resources>
	<Grid>
		<Grid.RowDefinitions >
			<RowDefinition Height="*"/>
			<RowDefinition Height="Auto"/>
		</Grid.RowDefinitions>
		<Grid>
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto"/>
				<RowDefinition Height="*"/>
			</Grid.RowDefinitions>

			<!-- Exception Settings Section -->
			<GroupBox Header="Current Exceptions" Grid.Row="0">
				<StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
					<Button Content="Enable All" Command="{Binding EnableAllCommand}" MinWidth="120"/>
					<Button Content="Disable All" Command="{Binding DisableAllCommand}" MinWidth="120"/>
				</StackPanel>
			</GroupBox>

			<!-- Snapshot Management Section -->
			<GroupBox Header="Snapshot Management" Grid.Row="1">
				<Grid>
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="Auto"/>
						<ColumnDefinition Width="*"/>
						<ColumnDefinition Width="Auto"/>
					</Grid.ColumnDefinitions>
					<Grid.RowDefinitions>
						<RowDefinition Height="Auto"/>
						<RowDefinition Height="*" />
					</Grid.RowDefinitions>

					<!-- Save Snapshot Row -->
					<Grid Grid.Row="0" Grid.Column="1">
						<TextBox x:Name="SnapshotNameTextBox"
                                 MinWidth="150"
                                 Height="24"
                                 VerticalContentAlignment="Center"
                                 Text="{Binding NewSnapshotName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
							<TextBox.Style>
								<Style TargetType="TextBox" BasedOn="{StaticResource {x:Type TextBox}}">
									<Setter Property="Foreground" Value="{DynamicResource {x:Static vsshell:VsBrushes.SortTextKey}}"/>
									<Setter Property="Background" Value="{DynamicResource {x:Static vsshell:VsBrushes.SortBackgroundKey}}"/>
									<Setter Property="BorderBrush" Value="{DynamicResource {x:Static vsshell:VsBrushes.SearchBoxBorderKey}}"/>
									<Style.Triggers>
										<DataTrigger Binding="{Binding FailedValidation}" Value="True">
											<Setter Property="BorderBrush" Value="Red"/>
											<Setter Property="BorderThickness" Value="2"/>
										</DataTrigger>
									</Style.Triggers>
								</Style>
							</TextBox.Style>
						</TextBox>
						<TextBlock IsHitTestVisible="False"
                                   Text="Enter snapshot name..."
                                   VerticalAlignment="Center"
                                   HorizontalAlignment="Left"
                                   Margin="10,0,0,0"
                                   Foreground="{DynamicResource {x:Static vsshell:VsBrushes.GrayTextKey}}">
							<TextBlock.Style>
								<Style TargetType="TextBlock">
									<Setter Property="Visibility" Value="Collapsed"/>
									<Style.Triggers>
										<DataTrigger Binding="{Binding Text, ElementName=SnapshotNameTextBox}" Value="">
											<Setter Property="Visibility" Value="Visible"/>
										</DataTrigger>
									</Style.Triggers>
								</Style>
							</TextBlock.Style>
						</TextBlock>
					</Grid>
					<Button Grid.Row="0" Grid.Column="2"
                            Content="Save"
                            Command="{Binding SaveSnapshotCommand}"/>

					<ListView
                Grid.Row="1" d:Height="100"
				Grid.ColumnSpan="3" ScrollViewer.HorizontalScrollBarVisibility="Hidden"
	VerticalAlignment="Top"
						Margin="0,5,0,0"
                ItemsSource="{Binding SnapshotVms}"
                SelectedValue="{Binding SelectedSnapshot, Mode=OneWayToSource}"
                SelectedIndex="{Binding SelectedSnapshotIndex, Mode=TwoWay}"
                Foreground="{DynamicResource {x:Static vsshell:VsBrushes.PanelTextKey}}"
                Background="{DynamicResource {x:Static vsshell:VsBrushes.DropDownBackgroundKey}}"
                BorderBrush="{DynamicResource {x:Static vsshell:VsBrushes.PanelBorderKey}}"
                Loaded="ListView_Loaded"
                SizeChanged="ListView_SizeChanged">
						<ListView.Resources>
							<Ctr:DataContextSpy x:Key="dataContextSpy"/>
							<Style TargetType="{x:Type ListViewItem}">
								<Setter Property="HorizontalContentAlignment" Value="Stretch" />
								<Setter Property="acb:CommandBehavior.Event" Value="MouseDoubleClick"/>
								<Setter Property="acb:CommandBehavior.Command" Value="{Binding Source={StaticResource dataContextSpy}, Path=DataContext.ActivateSnapshotCommand}"/>
								<Setter Property="acb:CommandBehavior.CommandParameter" Value="{Binding}" />
								<Setter Property="Foreground" Value="{DynamicResource {x:Static vsshell:VsBrushes.WindowTextKey}}"/>
								<Style.Triggers>
									<DataTrigger Binding="{Binding Path=FieldDef.DispDetail, Mode=OneWay}" Value="False">
										<Setter Property="Visibility" Value="Collapsed"/>
									</DataTrigger>
									<Trigger Property="IsSelected" Value="true">
										<Setter Property="Background" Value="{DynamicResource {x:Static vs_shell:TreeViewColors.SelectedItemActiveBrushKey}}" />
										<Setter Property="Foreground" Value="{DynamicResource {x:Static vs_shell:TreeViewColors.SelectedItemActiveTextBrushKey}}" />
									</Trigger>
									<Trigger Property="IsMouseOver" Value="true">
										<Setter Property="Background" Value="{DynamicResource {x:Static vsshell:VsBrushes.CommandBarHoverKey}}" />
									</Trigger>
								</Style.Triggers>


							</Style>
							<Style TargetType="{x:Type GridViewColumnHeader}">
								<Setter Property="Foreground" Value="{DynamicResource {x:Static vsshell:VsBrushes.PanelTextKey}}"/>
								<Setter Property="Background" Value="{DynamicResource {x:Static vsshell:VsBrushes.DropDownBackgroundKey}}"/>
								<Setter Property="BorderBrush" Value="{DynamicResource {x:Static vsshell:VsBrushes.PanelBorderKey}}"/>
								<Setter Property="Template">
									<Setter.Value>
										<ControlTemplate TargetType="{x:Type GridViewColumnHeader}">
											<Border Background="{TemplateBinding Background}">
												<ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
											</Border>
										</ControlTemplate>
									</Setter.Value>
								</Setter>
								<Style.Triggers>
									<Trigger Property="IsMouseOver" Value="True">
										<Setter Property="Background" Value="{DynamicResource {x:Static vsshell:VsBrushes.ButtonHighlightKey}}"/>
									</Trigger>
								</Style.Triggers>
							</Style>
						</ListView.Resources>
						<ListView.View>
							<GridView>
								<GridViewColumn Width="30" Header="">
									<GridViewColumn.CellTemplate>
										<DataTemplate>
											<Button Content="X"
                                            Command="{Binding Source={StaticResource dataContextSpy}, Path=DataContext.DeleteSnapshotCommand}"
                                            CommandParameter="{Binding}"
                                            MinWidth="20"
                                            Padding="2"
                                            Margin="0"
                                            ToolTip="Delete this snapshot"/>
										</DataTemplate>
									</GridViewColumn.CellTemplate>
								</GridViewColumn>
								<GridViewColumn Width="Auto" Header="Name" DisplayMemberBinding="{Binding Name}"/>

								<!--<GridViewColumn Width="Auto" Header="Break">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <CheckBox IsChecked="{Binding Break}"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn Width="Auto" Header="Modules">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="Empty"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>-->
							</GridView>
						</ListView.View>
					</ListView>
				</Grid>
				<!-- Saved Snapshots List -->
			</GroupBox>
		</Grid>
		<GroupBox Header="Current Exception" Grid.Row="1">
			<Grid>
				<Grid.RowDefinitions>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="Auto"/>
				</Grid.RowDefinitions>

				<!-- Skip Button and Auto Skip -->
				<StackPanel Grid.Row="0" Orientation="Horizontal">
					<Button Content="Skip This Exception"
                            Command="{Binding GoCommand}"
                            MinWidth="140"/>
					<CheckBox Content="Auto Skip"
                              IsChecked="{Binding AutoSkip}"/>
				</StackPanel>

				<!-- Ignore List Options -->
				<GroupBox Grid.Row="1" Header="Exception Filtering">
					<StackPanel>
						<CheckBox Content="Add to Ignore List"
                                  IsChecked="{Binding AddToIgnoreList}"/>
						<CheckBox Content="Ignore by Module"
                                  IsChecked="{Binding RespectModuleName}"/>
					</StackPanel>
				</GroupBox>
			</Grid>
		</GroupBox>
	</Grid>
</UserControl>
